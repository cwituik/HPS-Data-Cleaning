library(tidyverse)
library(openxlsx)
getwd()

#Import Data
data <- readxl::read_xlsx("HPS Use of Force.xlsx", sheet = 2)

#remove numbers and characters from perceived race
data <- data%>%
  mutate(subject1_perceived_race=trimws(str_remove(subject1_perceived_race, "(\\s+[A-Za-z]+)?[0-9-]+")))%>%
  mutate(subject2_perceived_race=trimws(str_remove(subject2_perceived_race, "(\\s+[A-Za-z]+)?[0-9-]+")))%>%
  mutate(subject3_perceived_race=trimws(str_remove(subject3_perceived_race, "(\\s+[A-Za-z]+)?[0-9-]+")))


#Clean Perceived Race
table(data$subject1_perceived_race)
table(data$subject2_perceived_race)
table(data$subject3_perceived_race)

data$subject1_perceived_race <- recode(data$subject1_perceived_race, "E/S/E"="E/S/E Asian",
                                       "Middle"="Middle Eastern",
                                       "S/Asian"="South Asian",
                                       "South"="South Asian")

#Clean Generated By
table(data$generated_by)
data$generated_by <- recode(data$generated_by, "Gangs and Weapons\r\n Unit"="Gangs and Weapons",
                            "Gangs and\r\n Weapons"="Gangs and Weapons",
                            "Intelligence\r\n Unit"="Intelligence",
                            "Major\r\n Crime"="Major Crime",
                            "Uniform\r\n Patrol"="Uniform Patrol",
                            "Uniform"="Uniform Patrol",
                            "Officer"="Uniform Patrol",
                            "Vice and Drug Unit"="Vice and Drugs",
                            "Vice and\r\n Drugs"="Vice and Drugs",
                            "Vice and\r\n Drug Unit"="Vice and Drugs",
                            "Hamilton\r\n Fire"="Hamilton Fire",
                            "Fire"="Hamilton Fire",
                            "Outside\r\n Agency"="Outside Agency",
                            "Outside\r\n agency"="Outside Agency",
                            "CID"="CIB")

table(data$generated_by)

#Clean Occurrence Type
table(data$occurrence_type)
data$occurrence_type <- recode(data$occurrence_type, "Barricaded\r\n Person"="Barricaded Person",
                               "CDSA\r\n Offence"="CDSA",
                               "CDSA\r\n Search\r\n Warrant"="CDSA",
                               "CDSA\r\n Warrant"="CDSA",
                               "CDSA –\r\n Search\r\n warrant"="CDSA",
                               "CDSA search\r\n warrant"="CDSA",
                               "CDSA Search\r\n warrant"="CDSA",
                               "CDSA Search\r\n Warrant"="CDSA",
                               "CDSA search warrant"="CDSA",
                               "CDSA Search warrant"="CDSA",
                               "CDSA Search Warrant"="CDSA",
                               "Driving\r\n Complaint"="Driving Complaint",
                               "Fail to\r\n Remain"="Fail to Remain",
                               "Fire call"="Fire Assist",
                               "Fire Call"="Fire Assist",
                               "Firearm\r\n Offences"="Firearm Investigation",
                               "Firearms investigation"="Firearm Investigation",
                               "Found\r\n Person"="Found Person",
                               "Neighbour\r\n Trouble"="Neighbour Trouble",
                               "Person in\r\n crisis"="Person in Crisis",
                               "Person in\r\n Crisis"="Person in Crisis",
                               "Person In\r\n Crisis"="Person in Crisis",
                               "Person in crisis"="Person in Crisis",
                               "Person In Crisis"="Person in Crisis",
                               "Search\r\n warrant"="Search Warrant",
                               "Search\r\n Warrant"="Search Warrant",
                               "Search warrant"="Search Warrant",
                               "Suspicious\r\n Person"="Suspicious Person",
                               "Suspicious person"="Suspicious Person",
                               "Suspicious\r\n Vehicle"="Suspicious Vehicle",
                               "Suspicious vehicle"="Suspicious Vehicle",
                               "Unwanted\r\n Guest"="Unwanted Guest",
                               "Wanted\r\n Person"="Wanted Party",
                               "Wanted\r\n Party"="Wanted Party",
                               "Weapons call"="Weapons Call",
                               "Weapon Call"="Weapons Call",
                               "Weapon in\r\n progress"="Weapons Call",
                               "Weapon in progress"="Weapons Call",
                               "Weapons"="Weapons Call",
                               "Weapons\r\n call"="Weapons Call",
                               "Weapons\r\n Call"="Weapons Call",
                               "Weapons Call –\r\n Barricaded"="Weapons Call",
                               "Weapons Calls"="Weapons Call",
                               "Weapons in\r\n progress"="Weapons Call",
                               "Weapons in progress"="Weapons Call")
table(data$occurrence_type)

#clean weapon carried subject
table(data$weapon_carried_subject)

data$weapon_carried_subject <- recode(data$weapon_carried_subject, "Access to\r\n firearms"="Access to Firearms",
                                      "Access to\r\n Firearms"="Access to Firearms",
                                      "Access to firearm"="Access to Firearms",
                                      "Access to Firearms"="Access to Firearms",
                                      "Access to firearms"="Access to Firearms",
                                      "Access to weapons"="Access to Weapons",
                                      "Firearm\r\n concealed"="Firearm Concealed",
                                      "Firearm\r\n Concealed"="Firearm Concealed",
                                      "Firearm concealed"="Firearm Concealed",
                                      "Firearm –\r\n Concealed"="Firearm Concealed",
                                      "Firearm – at hand"="Firearm - At Hand",
                                      "Firearm – at\r\n hand"="Firearm - At Hand",
                                      "Firearm – At\r\n hand"="Firearm - At Hand",
                                      "Firearm – at hand"="Firearm - At Hand",
                                      "Firearm – in\r\n hand"="Firearm - At Hand",
                                      "Firearm – In\r\n hand"="Firearm - At Hand",
                                      "Firearm – in hand"="Firearm - At Hand",
                                      "Firearm  In hand"="Firearm - At Hand",
                                      "Firearm at hand"="Firearm - At Hand",
                                      "Firearm in hand"="Firearm - At Hand",
                                      "Firearm – at hand"="Firearm - At Hand",
                                      "Firearms – at hand"="Firearm - At Hand",
                                      "Firearms – Carried"="Firearm - Carried",
                                      "Firearm - At Hand"="Firearm - At Hand",
                                      "Firearm – In hand"="Firearm - At Hand",
                                      "Firearm\r\n mentioned"="Firearm - Mentioned",
                                      "Firearm –\r\n mentioned"="Firearm - Mentioned",
                                      "Firearm –\r\n Mentioned"="Firearm - Mentioned",
                                      "Firearm mentioned"="Firearm - Mentioned",
                                      "Firearm Mentioned"="Firearm - Mentioned",
                                      "Firearms\r\n mentioned"="Firearm - Mentioned",
                                      "firearms mentioned"="Firearm - Mentioned",
                                      "Firearms\r\n mentioned"="Firearm - Mentioned",
                                      "Firearms mentioned"="Firearm - Mentioned",
                                      "Mention of Firearm"="Firearm - Mentioned",
                                      "Mention of\r\n firearm"="Firearm - Mentioned",
                                      "Firearms mentioned"="Firearm - Mentioned",
                                      "Firearm\r\n discharged at Police"="Firearm - Discharged at Police",
                                      "Firearm discharged"="Firearm - Discharged",
                                      "Firearm discharged at Police"="Firearm - Discharged at Police",
                                      "Firearm shot at police"="Firearm - Discharged at Police",
                                      "Firearm used"="Firearm - Discharged",
                                      "Firearm Used"="Firearm - Discharged",
                                      "Firearm used\r\n and mentioned"="Firearm - Discharged",
                                      "Firearm used"="Firearm - Discharged",
                                      "Firearm\r\n pointed at\r\n Police"="Firearm - Pointed at Police",
                                      "Firearm\r\n pointed at\r\n Police"="Firearm - Pointed at Police",
                                      "Firearm Pointed at\r\n Police"="Firearm - Pointed at Police",
                                      "Firearm Concealed"="Firearm - Concealed",
                                      "Firearms – Carried"="Firearm - Carried",
                                      "Firearm in\r\n house"="Firearm - In House",
                                      "Firearm in vehicle"="Firearm - In Vehicle",
                                      "Firearms – In\r\n vehicle"="Firearm - In Vehicle",
                                      "Firearms – in residence"="Firearm - In House",
                                      "Firearms – In vehicle"="Firearm - In Vehicle",
                                      "Firearms in\r\n vehicle"="Firearm - In Vehicle",
                                      "Firearms in residence"="Firearm - In House",
                                      "Firearms – In vehicle"="Firearm - In Vehicle",
                                      "Firearm in residence"="Firearm - House",
                                      "Active resistant"="Active Resistant",
                                      "Assaultive,\r\n active resistant"="Assaultive, Active Resistant",
                                      "Edge weapon –\r\n in hand"="Edged weapon at Hand",
                                      "Edge Weapon –\r\n in hand"="Edged weapon at Hand",
                                      "Edged Weapon\r\n – at hand"="Edged weapon at Hand",
                                      "Edged weapon in hand"="Edged weapon at Hand",
                                      "Edged weapon in Hand"="Edged weapon at Hand",
                                      "History of\r\n Weapons"="History of Weapons",
                                      "History of\r\n firearms"="History of Firearms",
                                      "History of firearms"="History of Firearms",
                                      "History/Access\r\n to firearms"="History of Firearms",
                                      "History of Firearms"="History of Firearms",
                                      "History of firearm"="History of Firearms",
                                      "History of\r\n Firearms"="History of Firearms",
                                      "Firearm history"="History of Firearms",
                                      "Firearms history"="History of Firearms",
                                      "Knife – at hand"="Knife - At Hand",
                                      "Knife – At hand"="Knife - At Hand",
                                      "Knife – in hand"="Knife - At Hand",
                                      "Knife – In hand"="Knife - At Hand",
                                      "Knife at hand"="Knife - At Hand",
                                      "Knife in hand"="Knife - At Hand",
                                      "Firearm mentioned\r\n knife – at hand"="Firearm - Mentioned / Knife - At Hand",
                                      "Knife/Edged Weapons - in\r\n hand"="Knife - At Hand",
                                      "Knife - In hand"="Knife - At Hand",
                                      "Knife/Edged Weapons – in\r\n hand"="Knife - At Hand",
                                      "Knife –\r\n Mentioned"="Knife - Mentioned",
                                      "Knife\r\n mentioned"="Knife - Mentioned",
                                      "Mention of\r\n weapon (knife)"="Knife - Mentioned",
                                      "Knife –\r\n Concealed"="Knife - Concealed",
                                      "Knife concealed"="Knife - Concealed",
                                      "Weapon - in\r\n hand"="Weapon - At Hand",
                                      "Weapon – in hand"="Weapon - At Hand",
                                      "Weapon – In hand"="Weapon - At Hand",
                                      "Weapon at\r\n hand"="Weapon - At Hand",
                                      "Weapon at hand"="Weapon - At Hand",
                                      "Weapon in\r\n hand"="Weapon - At Hand",
                                      "Weapon in hand"="Weapon - At Hand",
                                      "Weapons at\r\n hand"="Weapon - At Hand",
                                      "Weapons at hand"="Weapon - At Hand",
                                      "Weapon – in\r\n hand"="Weapon - At Hand",
                                      "Weapons of opportunity at\r\n hand"="Weapon - At Hand",
                                      "Weapons of opportunity in\r\n hands"="Weapon - At Hand",
                                      "Knife –\r\n attacking officers"="Attacking Police",
                                      "Knife –\r\n attacking Police"="Attacking Police",
                                      "Knife in hand\r\n Charging Police"="Attacking Police",
                                      "Knife in hand –\r\n lunged at officers"="Attacking Police",
                                      "Knife in hand –\r\n moving\r\n towards Police"="Knife in Hand Moving Towards Police",
                                      "Knife in hand lunged at\r\n officers"="Attacking Police",
                                      "Throwing Items at officers"="Throwing Items at Police",
                                      "Edged Weapon\r\n – in hand charged at\r\n Police"="Attacking Police",
                                      "Edge weapon concealed, Assaultive"="Edge Weapon Concealed / Assaultive",
                                      "Passive\r\n resistant non\r\n compliant"="Passive Resistant/Non Compliant",
                                      "Passive\r\n resistant non compliance"="Passive Resistant/Non Compliant",
                                      "Passive resistant non\r\n compliant"="Passive Resistant/Non Compliant",
                                      "Resistant"="Resistant",
                                      "Resistant\r\n information of knife concealed"="Resistant / Knife - Concealed",
                                      "Knife\r\n concealed. Active resistant"="Resistant / Knife - Concealed",
                                      "Non compliant"="Non Compliant",
                                      "Weapons Mentioned"="Weapon - Mentioned",
                                      "Weapons\r\n mentioned"="Weapon - Mentioned",
                                      "Weapon\r\n mentioned"="Weapon - Mentioned",
                                      "Weapon\r\n concealed"="Weapon - Concealed",
                                      "Weapon concealed"="Weapon - Concealed",
                                      "Weapons\r\n Concealed"="Weapon - Concealed",
                                      "Weapons concealed"="Weapon - Concealed",
                                      "Weapons in\r\n house"="Weapon - In House",
                                      "Weapons in vehicle"="Weapon - In Vehicle",
                                      "Attempting self\r\n harm"="Attempting Self Harm")
table(data$weapon_carried_subject)

#Clean officer response
table(data$officer_response)
data$officer_response <- recode(data$officer_response, "ACTION – Handgun drawn"="ACTION – Handgun Drawn",
                                "ACTION – Handgun Drawn"="ACTION – Handgun Drawn",
                                "ERU – EH soft, EH hard,\r\n CEW"="EH soft, EH hard, CEW",
                                "ERU – Firearm point"="ERU - Firearm Point",
                                "ERU – Point Firearm"="ERU - Firearm Point",
                                "ERU – Point firearm"="ERU - Firearm Point",
                                "ERU- Firearm Point"="ERU - Firearm Point",
                                "ERU- EH soft, CEW"="ERU – EH soft, CEW",
                                "Gangs and Weapons –\r\n Firearm Point"="Gangs and Weapons - Firearm Point",
                                "Intelligence – Firearm\r\n Point"="Intelligence - Firearm Point",
                                "Intelligence – Firearm Point"="Intelligence - Firearm Point",
                                "K9 – K9 Bite"="K9 - K9 Bite",
                                "K9 – K9"="K9 - K9 Bite",
                                "K9- K9 bite"="K9 - K9 Bite",
                                "MCRRT – EH hard, EH Soft,\r\n CEW"="MCRRT - EH hard, EH soft, CEW",
                                "MCRRT – Firearm point,\r\n CEW"="MCRRT - Firearm Point, CEW",
                                "MCRRT - EH hard, EH soft, CEW" = "MCRRT – EH hard, EH soft, CEW",
                                "Uniform – Cew"="Uniform Patrol - CEW",
                                "Uniform – CEW"="Uniform Patrol - CEW",
                                "Uniform Patrol– CEW"="Uniform Patrol - CEW",
                                "Uniform Patrol – CEW"="Uniform Patrol - CEW",
                                "Uniform patrol – CEW"="Uniform Patrol - CEW",
                                "Uniform Patrol – Cew"="Uniform Patrol - CEW",
                                "Uniform patrol – CEW"="Uniform Patrol - CEW",
                                "Uniform Patrol – CEW,\r\n Carbine Pistol"="Uniform Patrol - CEW, Carbine Pistol",
                                "Uniform Patrol – CEW, EH\r\n Hard, EH Soft"="Uniform Patrol - CEW, EH Hard, EH Soft",
                                "Uniform Patrol – E/H Hard,\r\n E/H Soft, CEW"="Uniform Patrol - CEW, EH Hard, EH Soft",
                                "Uniform Patrol – EH Hard,\r\n CEW"="Uniform Patrol - EH Hard, CEW",
                                "Uniform Patrol – CEW, EH Hard"="Uniform Patrol - EH Hard, CEW",
                                "Uniform Patrol – EH soft,\r\n CEW"="Uniform Patrol - EH soft, CEW",
                                "Uniform Patrol – EH Soft,\r\n CEW"="Uniform Patrol - EH soft, CEW",
                                "Uniform Patrol – CEW, EH Soft"="Uniform Patrol - EH soft, CEW",
                                "Uniform Patrol – CEW, EH soft"="Uniform Patrol - EH soft, CEW",
                                "Uniform Patrol – EHS, EHH,\r\n CEW"="Uniform Patrol - EHS, EHH, CEW",
                                "Uniform Patrol - Empty Hands Hard"="Uniform Patrol – EH hard",
                                "Uniform Patrol – EH hard"="Uniform Patrol – EH Hard",
                                "Uniform – Firearm point"="Uniform Patrol - Firearm Point",
                                "Uniform – Firearm Point"="Uniform Patrol - Firearm Point",
                                "Uniform Patrol– Firearm Point"="Uniform Patrol - Firearm Point",
                                "Uniform Patrol- Firearm\r\n Point"="Uniform Patrol - Firearm Point",
                                "Uniform Patrol – Firearm point"="Uniform Patrol - Firearm Point",
                                "Uniform patrol – Firearm Point"="Uniform Patrol - Firearm Point",
                                "Uniform Patrol –Firearm Point"="Uniform Patrol - Firearm Point",
                                "Uniform Patrol – Firearm\r\n point"="Uniform Patrol - Firearm Point",
                                "Uniform Patrol – Firearms Point"="Uniform Patrol - Firearm Point",
                                "Uniform Patrol – firearm\r\n point"="Uniform Patrol - Firearm Point",
                                "Uniform Patrol – firearm\r\n point"="Uniform Patrol - Firearm Point",
                                "Uniform Patrol – Firearm\r\n Point"="Uniform Patrol - Firearm Point",
                                "Uniform Patrol – Firearm\r\n point, EH Soft, CEW"="Uniform Patrol - Firearm Point, EH Soft, CEW",
                                "Uniform Patrol – Firearm\r\n discharge, EH Hard"="Uniform Patrol - Firearm Discharge, EH Hard",
                                "Uniform Patrol – Firearm\r\n Point"="Uniform Patrol - Firearm Point",
                                "Uniform Patrol –\r\n I/Weapon hard"="Uniform Patrol - Weapon Hard",
                                "Uniform – Animal Dispatch"="Uniform Patrol - Animal Dispatch",
                                "Uniform Patrol – Animal dispatch"="Uniform Patrol - Animal Dispatch",
                                "Uniform Patrol – Animal Dispatch"="Uniform Patrol - Animal Dispatch",
                                "Uniform Patrol – Animal\r\n dispatch"="Uniform Patrol - Animal Dispatch",
                                "Uniform Patrol – Animal\r\n Dispatch"="Uniform Patrol - Animal Dispatch",
                                "Uniform Patrol – Animal dispatch"="Uniform Patrol - Animal Dispatch",
                                "Uniform Patrol – Dispatch\r\n animal"="Uniform Patrol - Animal Dispatch",
                                "Uniform Patrol – Animal\r\n dispatch"="Uniform Patrol - Animal Dispatch",
                                "Uniform Patrol – Animal\r\n dispatch"="Uniform Patrol - Animal Dispatch",
                                "Uniform Patrol – Animal Dispatch"="Uniform Patrol - Animal Dispatch",
                                "Uniform Patrol – Dispatch animal"="Uniform Patrol - Animal Dispatch",
                                "Uniform Patrol – Dispatch\r\n animal"="Uniform Patrol - Animal Dispatch",
                                "Uniform Patrol – Dispatch Animal"="Uniform Patrol - Animal Dispatch",
                                "Uniform Patrol – Dispatch\r\n Animal"="Uniform Patrol - Animal Dispatch",
                                "Uniform Patrol – Animal\r\n Dispatch"="Uniform Patrol - Animal Dispatch",
                                "Uniform Patrol – CEW,\r\n empty hands soft"="Uniform Patrol - EH soft, CEW",
                                "Uniform Patrol – CEW,\r\n Firearm Point"="Uniform Patrol - CEW, Firearm Point",
                                "Uniform Patrol – Handgun\r\n Drawn"="Uniform Patrol - Handgun Drawn",
                                "Uniform Patrol – Handgun\r\n drawn"="Uniform Patrol - Handgun Drawn",
                                "Uniform Patrol – handgun\r\n drawn"="Uniform Patrol - Handgun Drawn",
                                "Uniform patrol – Handgun\r\n Drawn"="Uniform Patrol - Handgun Drawn",
                                "Uniform Patrol – Handgun Drawn"="Uniform Patrol - Handgun Drawn",
                                "Uniform Patrol – Handgun drawn"="Uniform Patrol - Handgun Drawn",
                                "Uniform Patrol – handgun drawn"="Uniform Patrol - Handgun Drawn",
                                "Uniform Patrol- Firearm Point"="Uniform Patrol – Firearm Point",
                                "Youth Office – Firearm\r\n Point"="Youth Office - Firearm Point",
                                "Youth – Firearm point"="Youth Office - Firearm Point",
                                "Youth Office – Firearm Point"="Youth Office - Firearm Point",
                                "Youth – EH soft, Firearm\r\n Point"="Youth Office - EH Soft, Firearm Point",
                                "Youth – EH Hard, CEW"="Youth Office - EH Hard, CEW",
                                "Vice and Drugs – Firearm\r\n Point"="Vice and Drugs - Firearm Point",
                                "Vice and Drugs – Firearm\r\n point"="Vice and Drugs - Firearm Point",
                                "Uniform patrol –EH Soft,\r\n EH hard"="Uniform patrol - EH Soft, EH hard",
                                "Uniform Patrol – Firearm point, CEW"="Uniform Patrol - Firearm Point, CEW",
                                "Uniform Patrol – Firearm\r\n Point, CEW"="Uniform Patrol - Firearm Point, CEW",
                                "Uniform Patrol – Firearm\r\n Point, EH Hard"="Uniform Patrol - Firearm Point, EH Hard",
                                "Uniform Patrol – Firearm Point, EH Hard"="Uniform Patrol - Firearm Point, EH Hard",
                                "Uniform Patrol – Firearm\r\n point, EH Soft"="Uniform Patrol - Firearm Point, EH Soft",
                                "Uniform Patrol –\r\n I/Weapon hard"="Uniform Patrol - I/Weapon hard",
                                "Uniform Patrol – Hand gun\r\n Drawn, CEW"="Uniform Patrol - Hand gun Drawn, CEW",
                                "Uniform Patrol – Empty\r\n hands hard, E/H Soft"="Uniform patrol - EH Soft, EH hard",
                                "Uniform Patrol – Empty\r\n Hands Hard"="Uniform Patrol - Empty Hands Hard",
                                "Uniform Patrol – Empty\r\n hand soft"="Uniform Patrol - EH Soft",
                                "Uniform Patrol – Firearms Point, Empty hands Soft"="Uniform Patrol - Firearm Point, EH Soft")
table(data$officer_response)

#clean location
table(data$location)
data$location <- recode(data$location, "Other\r\n Jurisdiction"="Outside jurisdiction",
                        "Out of\r\n jurisdiction"="Outside jurisdiction",
                        "Outside\r\n jurisdiction"="Outside jurisdiction",
                        "Out of Jurisdiction"="Outside jurisdiction")
table(data$location)


#wide data exclude animals

wide_no_animal <- data%>%
  filter(weapon_carried_subject!="Coyote", weapon_carried_subject!="Deer", weapon_carried_subject!="Dog attacked officers", weapon_carried_subject!="Racoon" )

#long data excluding animals
data_long <- data%>%
  filter(weapon_carried_subject!="Coyote", weapon_carried_subject!="Deer", weapon_carried_subject!="Dog attacked officers", weapon_carried_subject!="Racoon" )

data_long <- data_long%>%
pivot_longer(cols=starts_with('sub'), names_to = "race", values_to = "perceived_race_individual")%>%
  filter(!is.na(perceived_race_individual))%>%
  ungroup()%>%
  select(-race)



#Write Data
write.xlsx(data, "HPS Clean Data.xlsx")
write.xlsx(wide_no_animal, "HPS Clean Data No Animals.xlsx")
write.xlsx(data_long, "HPS Clean Data No Animals Long.xlsx")
